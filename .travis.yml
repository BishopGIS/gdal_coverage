# This is the config file for building GDAL and running its autotest suite
# with Travis-ci.org on a Mac-OSX machine

language: objective-c

# We use clang, --without-libtool and --with-debug for faster build
compiler:
  - clang

install:
# build proj
  - curl http://download.osgeo.org/proj/proj-4.8.0.tar.gz > proj-4.8.0.tar.gz
  - tar xvzf proj-4.8.0.tar.gz
  - cd proj-4.8.0/nad
  - curl http://download.osgeo.org/proj/proj-datumgrid-1.5.tar.gz > proj-datumgrid-1.5.tar.gz
  - tar xvzf proj-datumgrid-1.5.tar.gz
  - cd ..
  - ./configure --prefix=/usr
  - make -j3
  - sudo make install
  - cd ..
# build GDAL
  - cd gdal
  - ./configure --prefix=/usr --enable-debug --with-jpeg12 --with-python
  - make -j3
  - cd apps
  - make test_ogrsf
  - cd ..
  - sudo make install
  - cd ../autotest/cpp
  - gdal-config --version
  - gdal-config --cflags
  - cat /usr/include/gdal.h
  - make -j3
  - cd ../../gdal

script:
# CPP unit tests
  - cd ../autotest
  - cd cpp
  - GDAL_SKIP=JP2ECW make quick_test
  - cd ..
# Does not work under MacOS. FIXME
  - rm ogr/ogr_osm.py
# Run all the Python autotests
  - python run_all.py

notifications:
  email:
    recipients:
      - gdal-commits@lists.osgeo.org

  irc:
    channels:
      - "irc.freenode.org#gdal"
    use_notice: true
    on_success: change

